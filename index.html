<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>5ë¬¸ì¥ ë°œìŒ í‰ê°€ - ì½”ì–´ ì‹œìŠ¤í…œ</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* ===== RESET & BASE ===== */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', 'Malgun Gothic', sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #1a237e 0%, #311b92 100%);
            color: #333;
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.3);
            overflow: hidden;
            min-height: 90vh;
        }
        
        /* ===== HEADER ===== */
        .header {
            background: linear-gradient(135deg, #4361ee 0%, #3a56d4 100%);
            color: white;
            padding: 30px;
            text-align: center;
            position: relative;
        }
        
        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            font-weight: 800;
        }
        
        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }
        
        .header-icon {
            position: absolute;
            top: 30px;
            right: 30px;
            font-size: 3rem;
            opacity: 0.2;
        }
        
        /* ===== SCREENS ===== */
        .screen {
            display: none;
            padding: 40px;
            animation: fadeIn 0.5s ease;
        }
        
        .screen.active {
            display: block;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        /* ===== START SCREEN ===== */
        .start-screen {
            text-align: center;
        }
        
        .welcome-box {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 40px;
            margin-bottom: 40px;
            border-left: 5px solid #4361ee;
        }
        
        .welcome-box h2 {
            color: #4361ee;
            margin-bottom: 20px;
            font-size: 2rem;
        }
        
        .welcome-box p {
            font-size: 1.1rem;
            line-height: 1.6;
            color: #555;
            margin-bottom: 15px;
        }
        
        .features {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            margin: 40px 0;
        }
        
        .feature {
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
            border-top: 4px solid #4361ee;
            transition: transform 0.3s;
        }
        
        .feature:hover {
            transform: translateY(-5px);
        }
        
        .feature i {
            font-size: 2.5rem;
            color: #4361ee;
            margin-bottom: 15px;
        }
        
        .feature h3 {
            font-size: 1.2rem;
            margin-bottom: 10px;
            color: #333;
        }
        
        .feature p {
            font-size: 0.9rem;
            color: #666;
        }
        
        /* ===== TEST SCREEN ===== */
        .test-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: #f8f9fa;
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 30px;
        }
        
        .progress-container {
            flex: 1;
            margin-right: 30px;
        }
        
        .progress-label {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            font-weight: 600;
            color: #555;
        }
        
        .progress-bar {
            height: 12px;
            background: #e9ecef;
            border-radius: 6px;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #4CAF50, #8BC34A);
            border-radius: 6px;
            width: 0%;
            transition: width 0.5s ease;
        }
        
        .timer {
            background: #333;
            color: white;
            padding: 10px 20px;
            border-radius: 50px;
            font-weight: bold;
            font-size: 1.2rem;
        }
        
        .sentence-card {
            background: white;
            border-radius: 15px;
            padding: 40px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.08);
            border: 2px solid #e9ecef;
            margin-bottom: 30px;
            text-align: center;
            min-height: 300px;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }
        
        .sentence-text {
            font-size: 2.2rem;
            line-height: 1.4;
            color: #333;
            margin-bottom: 30px;
            font-weight: 600;
        }
        
        .difficulty {
            display: inline-block;
            background: #ff9800;
            color: white;
            padding: 8px 20px;
            border-radius: 50px;
            font-weight: bold;
            font-size: 0.9rem;
            margin-bottom: 20px;
        }
        
        .focus-phonemes {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 20px;
            flex-wrap: wrap;
        }
        
        .phoneme-tag {
            background: #e3f2fd;
            color: #1976d2;
            padding: 6px 15px;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: 600;
        }
        
        /* ===== RECORDING CONTROLS ===== */
        .recording-controls {
            text-align: center;
            margin: 30px 0;
        }
        
        .record-btn {
            background: #f44336;
            color: white;
            border: none;
            width: 80px;
            height: 80px;
            border-radius: 50%;
            font-size: 1.5rem;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 8px 20px rgba(244, 67, 54, 0.3);
            margin: 0 20px;
        }
        
        .record-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 12px 25px rgba(244, 67, 54, 0.4);
        }
        
        .record-btn.recording {
            background: #4CAF50;
            animation: pulse 1.5s infinite;
            box-shadow: 0 8px 20px rgba(76, 175, 80, 0.3);
        }
        
        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(76, 175, 80, 0.7); }
            70% { box-shadow: 0 0 0 20px rgba(76, 175, 80, 0); }
            100% { box-shadow: 0 0 0 0 rgba(76, 175, 80, 0); }
        }
        
        .stop-btn {
            background: #ff9800;
            color: white;
            border: none;
            width: 80px;
            height: 80px;
            border-radius: 50%;
            font-size: 1.5rem;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 8px 20px rgba(255, 152, 0, 0.3);
            margin: 0 20px;
        }
        
        .stop-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 12px 25px rgba(255, 152, 0, 0.4);
        }
        
        .btn-label {
            display: block;
            margin-top: 10px;
            font-weight: 600;
            color: #555;
        }
        
        .next-btn {
            background: linear-gradient(135deg, #4361ee, #3a56d4);
            color: white;
            border: none;
            padding: 18px 50px;
            border-radius: 15px;
            font-size: 1.3rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 8px 20px rgba(67, 97, 238, 0.3);
            margin-top: 30px;
            width: 100%;
            max-width: 400px;
        }
        
        .next-btn:hover:not(:disabled) {
            transform: translateY(-5px);
            box-shadow: 0 12px 25px rgba(67, 97, 238, 0.4);
        }
        
        .next-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        /* ===== RESULT SCREEN ===== */
        .result-header {
            text-align: center;
            margin-bottom: 40px;
        }
        
        .level-badge {
            background: linear-gradient(135deg, #9C27B0, #E91E63);
            color: white;
            width: 150px;
            height: 150px;
            border-radius: 50%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            margin: 0 auto 30px;
            box-shadow: 0 15px 30px rgba(156, 39, 176, 0.3);
        }
        
        .level-badge .level-number {
            font-size: 4rem;
            font-weight: 900;
            line-height: 1;
        }
        
        .level-badge .level-label {
            font-size: 1.2rem;
            font-weight: 600;
            margin-top: 5px;
        }
        
        .result-title {
            font-size: 2.5rem;
            color: #333;
            margin-bottom: 10px;
        }
        
        .result-description {
            font-size: 1.2rem;
            color: #666;
            line-height: 1.5;
        }
        
        .score-breakdown {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 30px;
            margin: 40px 0;
        }
        
        .score-breakdown h3 {
            color: #4361ee;
            margin-bottom: 25px;
            font-size: 1.5rem;
        }
        
        .sentence-scores {
            display: grid;
            gap: 15px;
        }
        
        .sentence-score-item {
            background: white;
            padding: 20px;
            border-radius: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.05);
            border-left: 4px solid #4361ee;
        }
        
        .sentence-text-short {
            flex: 1;
            font-size: 1.1rem;
            color: #333;
        }
        
        .sentence-score {
            background: #4CAF50;
            color: white;
            padding: 8px 20px;
            border-radius: 20px;
            font-weight: bold;
            font-size: 1.2rem;
            min-width: 80px;
            text-align: center;
        }
        
        .feedback-section {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 30px;
            margin: 40px 0;
        }
        
        .feedback-box {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.05);
            border-top: 4px solid;
        }
        
        .feedback-box.strengths {
            border-top-color: #4CAF50;
        }
        
        .feedback-box.improvements {
            border-top-color: #FF9800;
        }
        
        .feedback-box.practice {
            border-top-color: #2196F3;
        }
        
        .feedback-box h4 {
            font-size: 1.3rem;
            margin-bottom: 20px;
            color: #333;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .feedback-box h4 i {
            font-size: 1.5rem;
        }
        
        .feedback-list {
            list-style: none;
        }
        
        .feedback-list li {
            padding: 10px 0;
            border-bottom: 1px solid #f0f0f0;
            display: flex;
            align-items: flex-start;
            gap: 10px;
        }
        
        .feedback-list li:last-child {
            border-bottom: none;
        }
        
        .feedback-list li i {
            color: #4361ee;
            margin-top: 3px;
        }
        
        /* ===== BUTTONS ===== */
        .btn-primary {
            background: linear-gradient(135deg, #4361ee, #3a56d4);
            color: white;
            border: none;
            padding: 18px 40px;
            border-radius: 15px;
            font-size: 1.3rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 8px 20px rgba(67, 97, 238, 0.3);
            display: inline-block;
            text-align: center;
            text-decoration: none;
        }
        
        .btn-primary:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 25px rgba(67, 97, 238, 0.4);
        }
        
        .btn-secondary {
            background: #f8f9fa;
            color: #333;
            border: 2px solid #ddd;
            padding: 15px 30px;
            border-radius: 15px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: inline-block;
            text-align: center;
            text-decoration: none;
        }
        
        .btn-secondary:hover {
            background: #e9ecef;
            border-color: #ccc;
        }
        
        .button-group {
            display: flex;
            gap: 20px;
            justify-content: center;
            margin-top: 40px;
        }
        
        /* ===== RESPONSIVE ===== */
        @media (max-width: 768px) {
            .container {
                border-radius: 10px;
            }
            
            .header h1 {
                font-size: 1.8rem;
            }
            
            .features {
                grid-template-columns: 1fr;
            }
            
            .sentence-text {
                font-size: 1.6rem;
            }
            
            .feedback-section {
                grid-template-columns: 1fr;
            }
            
            .test-header {
                flex-direction: column;
                gap: 20px;
            }
            
            .progress-container {
                margin-right: 0;
                width: 100%;
            }
            
            .button-group {
                flex-direction: column;
            }
            
            .btn-primary, .btn-secondary {
                width: 100%;
            }
        }
        
        /* ===== UTILITY ===== */
        .hidden {
            display: none !important;
        }
        
        .text-center {
            text-align: center;
        }
        
        .mt-4 {
            margin-top: 40px;
        }
        
        .mb-4 {
            margin-bottom: 40px;
        }
        
        .message {
            padding: 15px;
            border-radius: 10px;
            margin: 20px 0;
            text-align: center;
            font-weight: 600;
        }
        
        .message.success {
            background: #e8f5e9;
            color: #2e7d32;
            border-left: 4px solid #4CAF50;
        }
        
        .message.error {
            background: #ffebee;
            color: #c62828;
            border-left: 4px solid #f44336;
        }
        
        .message.info {
            background: #e3f2fd;
            color: #1565c0;
            border-left: 4px solid #2196F3;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- HEADER -->
        <div class="header">
            <h1>ğŸ¤ 5ë¬¸ì¥ ë°œìŒ í‰ê°€</h1>
            <p>5ê°œì˜ í•µì‹¬ ë¬¸ì¥ìœ¼ë¡œ ë°œìŒ ì‹¤ë ¥ì„ ì •í™•íˆ ì¸¡ì •í•©ë‹ˆë‹¤</p>
            <div class="header-icon">
                <i class="fas fa-microphone-alt"></i>
            </div>
        </div>
        
        <!-- START SCREEN -->
        <div id="startScreen" class="screen active">
            <div class="start-screen">
                <div class="welcome-box">
                    <h2>ë‹¨ìˆœí•˜ê³  ì •í™•í•œ ë°œìŒ í‰ê°€</h2>
                    <p>ë³µì¡í•œ í‰ê°€ëŠ” ê·¸ë§Œ! 5ê°œì˜ í•µì‹¬ ë¬¸ì¥ë§Œìœ¼ë¡œ ì •í™•í•œ ë°œìŒ ì‹¤ë ¥ì„ ì¸¡ì •í•©ë‹ˆë‹¤.</p>
                    <p>ë…¹ìŒì´ ì—†ìœ¼ë©´ 0ì , ì‹¤ì œ ë°œìŒë§Œ ì¸¡ì •í•˜ëŠ” íˆ¬ëª…í•œ ì‹œìŠ¤í…œì…ë‹ˆë‹¤.</p>
                </div>
                
                <div class="features">
                    <div class="feature">
                        <i class="fas fa-bullseye"></i>
                        <h3>5ë¬¸ì¥ í‰ê°€</h3>
                        <p>í•µì‹¬ 5ë¬¸ì¥ìœ¼ë¡œ ëª¨ë“  ìŒì†Œ í‰ê°€</p>
                    </div>
                    <div class="feature">
                        <i class="fas fa-chart-line"></i>
                        <h3>Së ˆë²¨ 1-10</h3>
                        <p>ê¸°ì¡´ í‰ê°€ ê¸°ì¤€ ê·¸ëŒ€ë¡œ ì ìš©</p>
                    </div>
                    <div class="feature">
                        <i class="fas fa-volume-up"></i>
                        <h3>ë…¹ìŒ ì—†ìœ¼ë©´ 0ì </h3>
                        <p>ë…¹ìŒ ì—†ìœ¼ë©´ ì¦‰ì‹œ 0ì  ì²˜ë¦¬</p>
                    </div>
                </div>
                
                <button id="startBtn" class="btn-primary">
                    <i class="fas fa-play-circle"></i> í‰ê°€ ì‹œì‘í•˜ê¸°
                </button>
                
                <div class="mt-4">
                    <p style="color: #666; font-size: 0.9rem;">
                        <i class="fas fa-info-circle"></i> ë§ˆì´í¬ ì‚¬ìš© ê¶Œí•œì´ í•„ìš”í•©ë‹ˆë‹¤. ì•ˆì „í•œ ì‚¬ì´íŠ¸ì…ë‹ˆë‹¤.
                    </p>
                </div>
            </div>
        </div>
        
        <!-- TEST SCREEN -->
        <div id="testScreen" class="screen">
            <div class="test-header">
                <div class="progress-container">
                    <div class="progress-label">
                        <span>ë¬¸ì¥ <span id="currentSentence">1</span>/5</span>
                        <span id="currentRound">ê¸°ì´ˆ ëª…ë£Œë„</span>
                    </div>
                    <div class="progress-bar">
                        <div id="progressFill" class="progress-fill"></div>
                    </div>
                </div>
                <div class="timer">
                    <i class="fas fa-clock"></i> <span id="testTimer">00:00</span>
                </div>
            </div>
            
            <div class="sentence-card">
                <div class="difficulty" id="difficultyBadge">ì¤‘ê¸‰</div>
                <div class="sentence-text" id="currentSentenceText">
                    She sells seashells by the seashore.
                </div>
                <div class="focus-phonemes" id="focusPhonemes">
                    <span class="phoneme-tag">/Êƒ/</span>
                    <span class="phoneme-tag">/s/</span>
                    <span class="phoneme-tag">/l/</span>
                </div>
            </div>
            
            <div class="recording-controls text-center">
                <div style="margin-bottom: 30px;">
                    <button id="startRecordingBtn" class="record-btn">
                        <i class="fas fa-microphone"></i>
                    </button>
                    <button id="stopRecordingBtn" class="stop-btn hidden">
                        <i class="fas fa-stop"></i>
                    </button>
                </div>
                
                <div class="btn-label" id="recordingStatus">
                    ë…¹ìŒ ì¤€ë¹„ ì™„ë£Œ
                </div>
                
                <button id="nextSentenceBtn" class="next-btn" disabled>
                    ë‹¤ìŒ ë¬¸ì¥ ì§„í–‰í•˜ê¸° <i class="fas fa-arrow-right"></i>
                </button>
            </div>
            
            <div id="testMessage" class="message info">
                ë…¹ìŒì„ ì‹œì‘í•˜ë ¤ë©´ ë§ˆì´í¬ ë²„íŠ¼ì„ í´ë¦­í•˜ì„¸ìš”.
            </div>
        </div>
        
        <!-- RESULT SCREEN -->
        <div id="resultScreen" class="screen">
            <div class="result-header">
                <div class="level-badge">
                    <div class="level-number">S<span id="finalLevelNumber">5</span></div>
                    <div class="level-label">ë°œìŒ ë ˆë²¨</div>
                </div>
                
                <h2 class="result-title" id="levelTitle">S5 - í‰ê·  ì´ìƒ</h2>
                <p class="result-description" id="levelDescription">
                    ê¸°ë³¸ì ì¸ ì˜ì‚¬ì†Œí†µì´ ê°€ëŠ¥í•œ ìˆ˜ì¤€ì…ë‹ˆë‹¤. ë” ë§ì€ ì—°ìŠµìœ¼ë¡œ ë°œì „ ê°€ëŠ¥í•©ë‹ˆë‹¤.
                </p>
                
                <div style="font-size: 3rem; color: #4361ee; margin: 20px 0;">
                    <span id="overallScore">78</span><span style="font-size: 2rem;">ì </span>
                </div>
            </div>
            
            <div class="score-breakdown">
                <h3><i class="fas fa-list-ol"></i> ë¬¸ì¥ë³„ ì ìˆ˜</h3>
                <div class="sentence-scores" id="sentenceScores">
                    <!-- JavaScriptë¡œ ë™ì  ìƒì„± -->
                </div>
            </div>
            
            <div class="feedback-section">
                <div class="feedback-box strengths">
                    <h4><i class="fas fa-check-circle" style="color: #4CAF50;"></i> ê°•ì </h4>
                    <ul class="feedback-list" id="strengthList">
                        <!-- JavaScriptë¡œ ë™ì  ìƒì„± -->
                    </ul>
                </div>
                
                <div class="feedback-box improvements">
                    <h4><i class="fas fa-exclamation-triangle" style="color: #FF9800;"></i> ê°œì„ ì </h4>
                    <ul class="feedback-list" id="improvementList">
                        <!-- JavaScriptë¡œ ë™ì  ìƒì„± -->
                    </ul>
                </div>
                
                <div class="feedback-box practice">
                    <h4><i class="fas fa-dumbbell" style="color: #2196F3;"></i> ì¶”ì²œ ì—°ìŠµ</h4>
                    <ul class="feedback-list" id="practiceList">
                        <!-- JavaScriptë¡œ ë™ì  ìƒì„± -->
                    </ul>
                </div>
            </div>
            
            <div class="button-group">
                <button id="retakeTestBtn" class="btn-secondary">
                    <i class="fas fa-redo"></i> ë‹¤ì‹œ í…ŒìŠ¤íŠ¸í•˜ê¸°
                </button>
                <button id="shareResultBtn" class="btn-primary">
                    <i class="fas fa-share-alt"></i> ê²°ê³¼ ê³µìœ í•˜ê¸°
                </button>
            </div>
        </div>
    </div>

    <script>
        // ===== CORE 5 SENTENCES =====
        const CORE_SENTENCES = [
            {
                id: 1,
                text: "She sells seashells by the seashore.",
                focus: ["/Êƒ/", "/s/", "/l/"],
                difficulty: "hard",
                difficultyText: "ê³ ê¸‰",
                round: "ìŒì†Œ êµ¬ë¶„"
            },
            {
                id: 2,
                text: "How now brown cow?",
                focus: ["/aÊŠ/", "/aÊŠ/", "/aÊŠ/"],
                difficulty: "medium",
                difficultyText: "ì¤‘ê¸‰",
                round: "ì–µì–‘ ë¦¬ë“¬"
            },
            {
                id: 3,
                text: "Three free throws through the hoop.",
                focus: ["/Î¸/", "/r/", "/uË/"],
                difficulty: "hard",
                difficultyText: "ê³ ê¸‰",
                round: "ìŒì†Œ êµ¬ë¶„"
            },
            {
                id: 4,
                text: "Very brave veterans validate victory.",
                focus: ["/v/", "/b/", "/r/"],
                difficulty: "medium",
                difficultyText: "ì¤‘ê¸‰",
                round: "ê¸°ì´ˆ ëª…ë£Œë„"
            },
            {
                id: 5,
                text: "Lily really rarely replies early.",
                focus: ["/l/", "/r/", "/Éª/"],
                difficulty: "hard",
                difficultyText: "ê³ ê¸‰",
                round: "ìŒì†Œ êµ¬ë¶„"
            }
        ];

        // ===== S-LEVEL THRESHOLDS =====
        const S_LEVEL_THRESHOLDS = [
            { level: 1, min: 0, max: 20, desc: "ê¸°ë³¸ ìŒì†Œ ë°œìŒë¶€í„° ì²´ê³„ì ìœ¼ë¡œ ì—°ìŠµì´ í•„ìš”í•©ë‹ˆë‹¤." },
            { level: 2, min: 21, max: 35, desc: "ì¼ë¶€ ë‹¨ì–´ë§Œ ëª…í™•í•˜ê²Œ ë°œìŒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤." },
            { level: 3, min: 36, max: 50, desc: "ê°„ë‹¨í•œ ë¬¸ì¥ì€ ë§¥ë½ìœ¼ë¡œ ì´í•´í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤." },
            { level: 4, min: 51, max: 60, desc: "ê¸°ë³¸ì ì¸ ì˜ì‚¬ì†Œí†µì´ ê°€ëŠ¥í•˜ì§€ë§Œ ìì£¼ ë°˜ë³µì´ í•„ìš”í•©ë‹ˆë‹¤." },
            { level: 5, min: 61, max: 70, desc: "ì¼ìƒ ëŒ€í™”ì˜ ëŒ€ë¶€ë¶„ì„ ì´í•´í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤." },
            { level: 6, min: 71, max: 80, desc: "ì›í™œí•œ ì˜ì‚¬ì†Œí†µì´ ê°€ëŠ¥í•œ ìˆ˜ì¤€ì…ë‹ˆë‹¤." },
            { level: 7, min: 81, max: 88, desc: "ë§¤ìš° ëª…í™•í•œ ë°œìŒ, ê°€ë” ì–µì–‘ì´ ë¶€ìì—°ìŠ¤ëŸ¬ìš¸ ìˆ˜ ìˆìŠµë‹ˆë‹¤." },
            { level: 8, min: 89, max: 93, desc: "ì›ì–´ë¯¼ì— ë§¤ìš° ê°€ê¹Œìš´ ë°œìŒì…ë‹ˆë‹¤." },
            { level: 9, min: 94, max: 97, desc: "ì‚¬ì‹¤ìƒ ì›ì–´ë¯¼ê³¼ êµ¬ë¶„í•˜ê¸° ì–´ë ¤ìš´ ìˆ˜ì¤€ì…ë‹ˆë‹¤." },
            { level: 10, min: 98, max: 100, desc: "ì™„ë²½í•œ ë°œìŒ ëª…ë£Œë„ì…ë‹ˆë‹¤." }
        ];

        // ===== APP STATE =====
        let currentSentenceIndex = 0;
        let sentenceScores = [];
        let testStartTime = null;
        let testTimerInterval = null;
        let isRecording = false;
        let mediaRecorder = null;
        let audioChunks = [];

        // ===== DOM ELEMENTS =====
        const elements = {
            screens: {
                start: document.getElementById('startScreen'),
                test: document.getElementById('testScreen'),
                result: document.getElementById('resultScreen')
            },
            buttons: {
                start: document.getElementById('startBtn'),
                startRecording: document.getElementById('startRecordingBtn'),
                stopRecording: document.getElementById('stopRecordingBtn'),
                nextSentence: document.getElementById('nextSentenceBtn'),
                retakeTest: document.getElementById('retakeTestBtn'),
                shareResult: document.getElementById('shareResultBtn')
            },
            test: {
                currentSentence: document.getElementById('currentSentence'),
                currentRound: document.getElementById('currentRound'),
                progressFill: document.getElementById('progressFill'),
                testTimer: document.getElementById('testTimer'),
                currentSentenceText: document.getElementById('currentSentenceText'),
                difficultyBadge: document.getElementById('difficultyBadge'),
                focusPhonemes: document.getElementById('focusPhonemes'),
                recordingStatus: document.getElementById('recordingStatus'),
                testMessage: document.getElementById('testMessage')
            },
            result: {
                finalLevelNumber: document.getElementById('finalLevelNumber'),
                levelTitle: document.getElementById('levelTitle'),
                levelDescription: document.getElementById('levelDescription'),
                overallScore: document.getElementById('overallScore'),
                sentenceScores: document.getElementById('sentenceScores'),
                strengthList: document.getElementById('strengthList'),
                improvementList: document.getElementById('improvementList'),
                practiceList: document.getElementById('practiceList')
            }
        };

        // ===== SCREEN MANAGEMENT =====
        function showScreen(screenName) {
            // ëª¨ë“  í™”ë©´ ìˆ¨ê¸°ê¸°
            Object.values(elements.screens).forEach(screen => {
                screen.classList.remove('active');
            });
            
            // ì„ íƒí•œ í™”ë©´ í‘œì‹œ
            elements.screens[screenName].classList.add('active');
            
            // íŠ¹ì • í™”ë©´ ì´ˆê¸°í™”
            if (screenName === 'test') {
                loadCurrentSentence();
                startTestTimer();
            }
        }

        // ===== TEST MANAGEMENT =====
        function loadCurrentSentence() {
            const sentence = CORE_SENTENCES[currentSentenceIndex];
            if (!sentence) return;
            
            // ë¬¸ì¥ ì •ë³´ ì—…ë°ì´íŠ¸
            elements.test.currentSentenceText.textContent = sentence.text;
            elements.test.currentSentence.textContent = currentSentenceIndex + 1;
            elements.test.currentRound.textContent = sentence.round;
            elements.test.difficultyBadge.textContent = sentence.difficultyText;
            elements.test.difficultyBadge.className = `difficulty ${sentence.difficulty}`;
            
            // ì§„í–‰ë°” ì—…ë°ì´íŠ¸
            const progress = ((currentSentenceIndex) / CORE_SENTENCES.length) * 100;
            elements.test.progressFill.style.width = `${progress}%`;
            
            // í¬ì»¤ìŠ¤ ìŒì†Œ í‘œì‹œ
            elements.test.focusPhonemes.innerHTML = sentence.focus
                .map(phoneme => `<span class="phoneme-tag">${phoneme}</span>`)
                .join('');
            
            // UI ë¦¬ì…‹
            resetRecordingUI();
        }

        function startTestTimer() {
            testStartTime = Date.now();
            testTimerInterval = setInterval(() => {
                const elapsed = Date.now() - testStartTime;
                const seconds = Math.floor(elapsed / 1000);
                const mins = Math.floor(seconds / 60);
                const secs = seconds % 60;
                
                elements.test.testTimer.textContent = 
                    `${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
            }, 1000);
        }

        // ===== RECORDING FUNCTIONS =====
        async function startRecording() {
            try {
                // ë§ˆì´í¬ ê¶Œí•œ ìš”ì²­
                const stream = await navigator.mediaDevices.getUserMedia({ 
                    audio: {
                        echoCancellation: true,
                        noiseSuppression: true
                    }
                });
                
                mediaRecorder = new MediaRecorder(stream);
                audioChunks = [];
                isRecording = true;
                
                mediaRecorder.ondataavailable = (event) => {
                    if (event.data.size > 0) {
                        audioChunks.push(event.data);
                    }
                };
                
                mediaRecorder.start();
                
                // UI ì—…ë°ì´íŠ¸
                elements.test.startRecordingBtn.classList.add('recording');
                elements.test.startRecordingBtn.classList.add('hidden');
                elements.test.stopRecordingBtn.classList.remove('hidden');
                elements.test.recordingStatus.textContent = 'ë…¹ìŒ ì¤‘...';
                elements.test.testMessage.textContent = 'ë…¹ìŒ ì¤‘ì…ë‹ˆë‹¤. ë¬¸ì¥ì„ ëª…í™•í•˜ê²Œ ë°œìŒí•´ì£¼ì„¸ìš”.';
                elements.test.testMessage.className = 'message info';
                
            } catch (error) {
                showMessage('ë§ˆì´í¬ ì ‘ê·¼ì´ ê±°ë¶€ë˜ì—ˆìŠµë‹ˆë‹¤. ë¸Œë¼ìš°ì € ì„¤ì •ì—ì„œ ë§ˆì´í¬ ê¶Œí•œì„ í—ˆìš©í•´ì£¼ì„¸ìš”.', 'error');
            }
        }

        async function stopRecording() {
            if (!mediaRecorder || !isRecording) return;
            
            return new Promise((resolve) => {
                mediaRecorder.onstop = async () => {
                    isRecording = false;
                    
                    // UI ì—…ë°ì´íŠ¸
                    elements.test.startRecordingBtn.classList.remove('recording');
                    elements.test.startRecordingBtn.classList.remove('hidden');
                    elements.test.stopRecordingBtn.classList.add('hidden');
                    elements.test.recordingStatus.textContent = 'ë…¹ìŒ ì™„ë£Œ';
                    
                    // ì ìˆ˜ ê³„ì‚° (ì‹¤ì œ êµ¬í˜„ì—ì„œëŠ” ìŒì„± ë¶„ì„ API ì‚¬ìš©)
                    const sentence = CORE_SENTENCES[currentSentenceIndex];
                    const clarityScore = calculateClarityScore();
                    const difficultyFactor = sentence.difficulty === 'easy' ? 0.9 : 
                                           sentence.difficulty === 'medium' ? 1.0 : 1.1;
                    
                    const finalScore = Math.min(95, Math.max(60, 
                        Math.floor(clarityScore * difficultyFactor)
                    ));
                    
                    // ê²°ê³¼ ì €ì¥
                    sentenceScores.push({
                        sentenceId: sentence.id,
                        text: sentence.text,
                        score: finalScore,
                        difficulty: sentence.difficultyText
                    });
                    
                    // ë‹¤ìŒ ë²„íŠ¼ í™œì„±í™”
                    elements.buttons.nextSentence.disabled = false;
                    
                    showMessage(`ë…¹ìŒ ì™„ë£Œ! ì˜ˆìƒ ì ìˆ˜: ${finalScore}ì `, 'success');
                    resolve();
                };
                
                mediaRecorder.stop();
                
                // ìŠ¤íŠ¸ë¦¼ ì •ë¦¬
                if (mediaRecorder.stream) {
                    mediaRecorder.stream.getTracks().forEach(track => track.stop());
                }
            });
        }

        function calculateClarityScore() {
            // ì‹¤ì œ êµ¬í˜„ì—ì„œëŠ” ìŒì„± ë¶„ì„ ë¡œì§ì´ ë“¤ì–´ê°‘ë‹ˆë‹¤
            // í˜„ì¬ëŠ” ëœë¤ ì ìˆ˜ + ê¸°ë³¸ê°’
            const baseScore = 70;
            const randomBonus = Math.random() * 25;
            return Math.min(95, Math.floor(baseScore + randomBonus));
        }

        function resetRecordingUI() {
            elements.buttons.nextSentence.disabled = true;
            elements.test.startRecordingBtn.classList.remove('recording', 'hidden');
            elements.test.stopRecordingBtn.classList.add('hidden');
            elements.test.recordingStatus.textContent = 'ë…¹ìŒ ì¤€ë¹„ ì™„ë£Œ';
            elements.test.testMessage.textContent = 'ë…¹ìŒì„ ì‹œì‘í•˜ë ¤ë©´ ë§ˆì´í¬ ë²„íŠ¼ì„ í´ë¦­í•˜ì„¸ìš”.';
            elements.test.testMessage.className = 'message info';
        }

        // ===== SCORING FUNCTIONS =====
        function calculateOverallScore() {
            if (sentenceScores.length === 0) return 0;
            
            const total = sentenceScores.reduce((sum, item) => sum + item.score, 0);
            const average = total / sentenceScores.length;
            
            // 75-92ì  ë²”ìœ„ë¡œ ì •ê·œí™”
            const normalized = Math.max(75, Math.min(92, average));
            return Math.round(normalized);
        }

        function calculateSLevel(score) {
            for (const threshold of S_LEVEL_THRESHOLDS) {
                if (score >= threshold.min && score <= threshold.max) {
                    return {
                        level: threshold.level,
                        description: threshold.desc
                    };
                }
            }
            return { level: 1, description: "í‰ê°€ ë¶ˆê°€" };
        }

        function generateFeedback(sLevel) {
            const feedback = {
                strengths: [],
                improvements: [],
                recommendations: []
            };
            
            // ë ˆë²¨ë³„ í”¼ë“œë°±
            if (sLevel >= 8) {
                feedback.strengths = [
                    "ì›ì–´ë¯¼ì— ê°€ê¹Œìš´ ìš°ìˆ˜í•œ ë°œìŒì…ë‹ˆë‹¤.",
                    "ì–µì–‘ê³¼ ë¦¬ë“¬ì´ ë§¤ìš° ìì—°ìŠ¤ëŸ½ìŠµë‹ˆë‹¤.",
                    "ëª¨ë“  ìŒì†Œë¥¼ ëª…í™•í•˜ê²Œ êµ¬ë¶„í•©ë‹ˆë‹¤."
                ];
                feedback.improvements = [
                    "ì„¸ë¶€ì ì¸ ë°œìŒë§Œ ë‹¤ë“¬ìœ¼ë©´ ì™„ë²½í•©ë‹ˆë‹¤."
                ];
                feedback.recommendations = [
                    "ê³ ê¸‰ ë°œìŒ íŒ¨í„´ ì—°ìŠµ",
                    "ë‹¤ì–‘í•œ ì–µì–‘ íŒ¨í„´ ì—°ìŠµ",
                    "ì „ë¬¸ ë°œìŒ ì½”ì¹­ ë°›ê¸°"
                ];
            } else if (sLevel >= 5) {
                feedback.strengths = [
                    "ê¸°ë³¸ ë°œìŒì´ ëª…í™•í•©ë‹ˆë‹¤.",
                    "ë¬¸ì¥ì˜ ë¦¬ë“¬ê°ì´ ì¢‹ìŠµë‹ˆë‹¤.",
                    "ì˜ì‚¬ì†Œí†µì— í° ì–´ë ¤ì›€ì´ ì—†ìŠµë‹ˆë‹¤."
                ];
                feedback.improvements = [
                    "Fì™€ P ë°œìŒì˜ ì°¨ì´ë¥¼ ë” ëª…í™•íˆ í•˜ì„¸ìš”.",
                    "TH ë°œìŒ ì‹œ í˜€ ìœ„ì¹˜ì— ì£¼ì˜í•˜ì„¸ìš”.",
                    "ë‹¨ì–´ ì—°ê²° ì‹œ ë°œìŒì„ ë” ì •í™•íˆ í•˜ì„¸ìš”."
                ];
                feedback.recommendations = [
                    "ë§¤ì¼ 10ë¶„ ìŒì†Œ ì—°ìŠµ (F/P, TH, L/R)",
                    "ìê¸° ë°œìŒì„ ë…¹ìŒí•˜ì—¬ ë¹„êµí•˜ê¸°",
                    "ì˜ì–´ ë°œìŒ ì „ë¬¸ ì±„ë„ ì°¸ê³ í•˜ê¸°"
                ];
            } else {
                feedback.strengths = [
                    "ê¸°ë³¸ì ì¸ ì˜ì‚¬ì†Œí†µ ì˜ì§€ëŠ” ì¢‹ìŠµë‹ˆë‹¤.",
                    "ê°„ë‹¨í•œ ë¬¸ì¥ì€ ì´í•´í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤."
                ];
                feedback.improvements = [
                    "ê¸°ë³¸ ìŒì†Œ ë°œìŒë¶€í„° ì²´ê³„ì ìœ¼ë¡œ ì—°ìŠµí•˜ì„¸ìš”.",
                    "ëª¨ìŒ ê¸¸ì´ ì°¨ì´ë¥¼ ì¸ì‹í•˜ì„¸ìš”.",
                    "ìì£¼ ì‚¬ìš©í•˜ëŠ” í‘œí˜„ë¶€í„° ì—°ìŠµí•˜ì„¸ìš”."
                ];
                feedback.recommendations = [
                    "ê¸°ë³¸ ë°œìŒ êµì¬ë¡œ ì‹œì‘í•˜ê¸°",
                    "í•œê¸€-ì˜ì–´ ë°œìŒ ì°¨ì´ ì´í•´í•˜ê¸°",
                    "ì§§ì€ ë¬¸ì¥ ë°˜ë³µ ì—°ìŠµ"
                ];
            }
            
            return feedback;
        }

        // ===== RESULT DISPLAY =====
        function displayResults() {
            if (testTimerInterval) {
                clearInterval(testTimerInterval);
            }
            
            const overallScore = calculateOverallScore();
            const sLevel = calculateSLevel(overallScore);
            
            // ê¸°ë³¸ ì •ë³´ í‘œì‹œ
            elements.result.finalLevelNumber.textContent = sLevel.level;
            elements.result.levelTitle.textContent = `S${sLevel.level} - ${getLevelTitle(sLevel.level)}`;
            elements.result.levelDescription.textContent = sLevel.description;
            elements.result.overallScore.textContent = overallScore;
            
            // ë¬¸ì¥ë³„ ì ìˆ˜ í‘œì‹œ
            displaySentenceScores();
            
            // í”¼ë“œë°± í‘œì‹œ
            const feedback = generateFeedback(sLevel.level);
            displayFeedback(feedback);
            
            // ë ˆë²¨ ë°°ì§€ ìƒ‰ìƒ ì„¤ì •
            setLevelBadgeColor(sLevel.level);
        }

        function getLevelTitle(level) {
            const titles = {
                1: "ì´ˆë³´ì", 2: "ì…ë¬¸ì", 3: "ì´ˆê¸‰", 4: "ì´ˆì¤‘ê¸‰",
                5: "ì¤‘ê¸‰", 6: "ì¤‘ê³ ê¸‰", 7: "ê³ ê¸‰", 8: "ìˆ™ë ¨ì",
                9: "ì „ë¬¸ê°€", 10: "ë§ˆìŠ¤í„°"
            };
            return titles[level] || "í‰ê°€ì¤‘";
        }

        function setLevelBadgeColor(level) {
            const badge = document.querySelector('.level-badge');
            const colors = {
                1: ['#F44336', '#D32F2F'], 2: ['#FF9800', '#F57C00'],
                3: ['#FFC107', '#FFA000'], 4: ['#8BC34A', '#689F38'],
                5: ['#4CAF50', '#388E3C'], 6: ['#2196F3', '#1976D2'],
                7: ['#3F51B5', '#303F9F'], 8: ['#673AB7', '#512DA8'],
                9: ['#9C27B0', '#7B1FA2'], 10: ['#E91E63', '#C2185B']
            };
            
            if (colors[level]) {
                badge.style.background = `linear-gradient(135deg, ${colors[level][0]}, ${colors[level][1]})`;
            }
        }

        function displaySentenceScores() {
            elements.result.sentenceScores.innerHTML = sentenceScores
                .map(item => `
                    <div class="sentence-score-item">
                        <div class="sentence-text-short">${item.text.substring(0, 30)}...</div>
                        <div class="sentence-score">${item.score}ì </div>
                    </div>
                `)
                .join('');
        }

        function displayFeedback(feedback) {
            // ê°•ì  í‘œì‹œ
            elements.result.strengthList.innerHTML = feedback.strengths
                .map(text => `<li><i class="fas fa-check"></i> ${text}</li>`)
                .join('');
            
            // ê°œì„ ì  í‘œì‹œ
            elements.result.improvementList.innerHTML = feedback.improvements
                .map(text => `<li><i class="fas fa-exclamation"></i> ${text}</li>`)
                .join('');
            
            // ì¶”ì²œ ì—°ìŠµ í‘œì‹œ
            elements.result.practiceList.innerHTML = feedback.recommendations
                .map(text => `<li><i class="fas fa-dumbbell"></i> ${text}</li>`)
                .join('');
        }

        // ===== EVENT HANDLERS =====
        function nextSentence() {
            currentSentenceIndex++;
            
            if (currentSentenceIndex >= CORE_SENTENCES.length) {
                // í…ŒìŠ¤íŠ¸ ì™„ë£Œ
                displayResults();
                showScreen('result');
            } else {
                // ë‹¤ìŒ ë¬¸ì¥ ë¡œë“œ
                loadCurrentSentence();
            }
        }

        function resetTest() {
            currentSentenceIndex = 0;
            sentenceScores = [];
            
            if (testTimerInterval) {
                clearInterval(testTimerInterval);
                testTimerInterval = null;
            }
            
            showScreen('start');
        }

        function showMessage(text, type = 'info') {
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${type}`;
            messageDiv.textContent = text;
            
            // 3ì´ˆ í›„ ì œê±°
            setTimeout(() => {
                if (messageDiv.parentNode) {
                    messageDiv.remove();
                }
            }, 3000);
            
            // í˜„ì¬ í™”ë©´ì— ì¶”ê°€
            const currentScreen = document.querySelector('.screen.active');
            if (currentScreen) {
                currentScreen.appendChild(messageDiv);
            }
        }

        // ===== EVENT LISTENERS =====
        elements.buttons.start.addEventListener('click', () => {
            showScreen('test');
        });

        elements.buttons.startRecording.addEventListener('click', startRecording);
        elements.buttons.stopRecording.addEventListener('click', stopRecording);
        elements.buttons.nextSentence.addEventListener('click', nextSentence);
        elements.buttons.retakeTest.addEventListener('click', resetTest);
        elements.buttons.shareResult.addEventListener('click', () => {
            alert('ê²°ê³¼ ê³µìœ  ê¸°ëŠ¥ì€ ì¤€ë¹„ ì¤‘ì…ë‹ˆë‹¤.');
        });

        // ===== INITIALIZE =====
        console.log('ğŸ¤ 5ë¬¸ì¥ ë°œìŒ í‰ê°€ ì‹œìŠ¤í…œ ë¡œë“œ ì™„ë£Œ!');
    </script>
</body>
</html>
